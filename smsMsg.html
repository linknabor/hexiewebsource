<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1,user-scalable=no" />
    <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <title></title>
    <script src="./static/jquery.js"></script> 
    <script src="./static/js/rem.js"></script>
    <style>
        .not {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #EEEEEE;;
            padding:0.6rem 0.3rem 0;
            overflow:auto;
        }
        .ov {
            overflow: hidden;
            padding: 1px;
        }
        .namelogo img{
            width:1rem;
            border-radius: 50%;
            margin-right: 0.2rem;
        }
        .content {
            background-color: #fff;
            border-radius: 0.3rem;
            width:73%;
            padding:0.3rem;
            margin-top:0.4rem;
            font-size: 0.41rem;
        }
        .content img{
            width:2rem;
        }
        .fl {
            float: left;
        }
        .adds {
            color: #3b3937;
            word-wrap:break-word;
            overflow:hidden;
            text-indent: 2em;
            letter-spacing: 0.04rem;
            margin-bottom: 0.17rem;
        }
        .datetime {
            font-size: 0.35rem;
            text-align: right;
            color: #a6937c;
        }
        .datetime img{
            width: 0.35rem;
            height: 0.35rem;
            position: relative;
            top: 0.02rem;
        }

        
        .result{position: fixed;top:0;left:0;background: rgba(0,0,0,0.5);z-index:1000;width:100%;height:100%;display: none;}  
        .imgresult{border:5px solid #fff;}
        .indiv{position: absolute;}

    </style>
    <script>
        var wechat_url = /127|test|file:/.test(location.origin)?'https://test.e-shequ.cn/wechat/hexie/wechat':
            /uat/.test(location.origin)?'https://uat.e-shequ.cn/wechat/hexie/wechat' : 'https://www.e-shequ.cn/wechat/hexie/wechat/';

        let  sms = {};
        let  batchNo = getUrlParam('batchNo');
        $('.showhide').hide();
        function getByBatch(batchNo) {
            $.ajax({
                type:"get",
                url:wechat_url+"/servplat/hexiemessage/getByBatch?batchNo="+batchNo,
                dataType:'json',
                data:{},
                success:function(res) {
                    if(res.success) {
                        sms = res.result;
                        $('.showhide').show();
                        $('.adds span').text(sms.content);
                        if(sms.img_urls !=null) {
                             $('.adds img').attr('src',sms.img_urls);
                        }
                        $('.datetime span').text(sms.date_time);
                    }else {
                        alert(res.message==null?"获取信息失败，请重试！":res.message);
                    }
                },
                error:function(err) {
                    console.log(err);
                }
            })
        }

        //获取参数
        function getUrlParam(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
            var r = window.location.search.substr(1).match(reg);  //匹配目标参数
            if (r != null) return unescape(r[2]); return ""; //返回参数值
        }

        // 请求接口
        getByBatch(batchNo);


        function showImg(outdiv,indiv,bigimg,thiselement){
        var winW = $(window).width();
        var winH = $(window).height();
        
        var screenHeight = $(window).height();
        var screenWidth = $(window).width();

        var src = $(thiselement).attr('src');
        $(bigimg).attr("src",src);
        $("<img/>").attr("src",src).load(function(){
            var imgW = this.width; 
            var imgH = this.height;
            var scale= imgW/imgH;
            if( imgW > winW ){
                $(bigimg).css("width","100%").css("height","auto");
                imgH = winW/scale;
                var h=(winH-imgH)/2;            
                $(indiv).css({"left":0,"top":h});
            }else{        
                $(bigimg).css("width",imgW+'px').css("height",imgH+'px');
                var w=(winW-imgW)/2;
                var h=(winH-imgH)/2;      
                $(indiv).css({"left":w,"top":h});
            }
            $(outdiv).fadeIn("fast");
            $(outdiv).click(function(){
                $(this).fadeOut("fast");
            });                             
        });
        }

        //点击放大图片
        $(function() {
            $('.adds img').click(function(){
                var thiselement=$(this);
                showImg("#outdiv",".indiv","#bigimg",thiselement);
            });
        })
       
    </script>
</head>
<body>
    <div class="not">
    <div class="ov showhide">
        <div class="fl namelogo">
            <img src="./static/images/common/hxlogo.png" alt="">
        </div>
        <div class="fl content">
            <div class="adds">
                <span></span>
                <img  src="" alt="">
            </div>
            <div class="datetime">
                <img src="./static/images/common/icon_time_gray.png" alt="">
                &nbsp;<span></span>
            </div>
        </div>
    </div>
    <div class="result" id="outdiv">
        <div class="indiv">
            <img class="imgresult" id="bigimg" src="">
        </div>  
    </div>
</body>
</html>